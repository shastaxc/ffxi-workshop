<h1 class="text-center">Odyssey Composer</h1>
<p class="text-center">Create group compositions for Odyssey NM runs.</p>

<mat-card class="table-container"
          [formGroup]="form">
  <div class="d-flex">
    <!--
      4 col layout
      First row = empty first cell, boss names x3 (acts as headers)
      Subsequent rows = player name, job assignment x3
    -->
    <!-- Col 1, player names -->
    <div class="flex-grow-1"
         formArrayName="players">
      <!-- Empty first cell -->
      <div>
        <mat-form-field class="invisible">
          <input matInput>
        </mat-form-field>
      </div>
      <!-- Subsequent cells pull player names -->
      <div class="text-end"
           *ngFor="let playerGroup of playerFormArray.controls; let i = index"
           [formGroup]="asFormGroup(playerGroup)">
        <mat-form-field>
          <mat-label>Player {{i+1}}</mat-label>
          <input matInput
                 formControlName="name">
        </mat-form-field>
      </div>
    </div>

    <!-- Col 2, Boss 1 -->
    <div class="d-flex"
         [formGroup]="bossesFormGroup">
      <div class="px-2">
        <!-- Boss name first col -->
        <mat-form-field>
          <mat-label>Boss 1</mat-label>
          <mat-select formControlName="first">
            <mat-option *ngFor="let bossKey of odyBossKeys"
                        [value]="bossKey">
              {{OdyBoss[bossKey]}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <!-- Subsequent cells pull player job assignments for boss -->
        <div *ngFor="let playerGroup of playerFormArray.controls; let i = index">
          <mat-form-field>
            <mat-label>Job 1</mat-label>
            <input matInput
                   [formControl]="getAssignmentControl(playerGroup, 1)">
          </mat-form-field>
        </div>
      </div>

      <!-- Col 3, Boss 2 -->
      <div class="px-2">
        <!-- Boss name first col -->
        <mat-form-field>
          <mat-label>Boss 2</mat-label>
          <mat-select formControlName="second">
            <mat-option *ngFor="let bossKey of odyBossKeys"
                        [value]="bossKey">
              {{OdyBoss[bossKey]}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <!-- Subsequent cells pull player job assignments for boss -->
        <div *ngFor="let playerGroup of playerFormArray.controls; let i = index">
          <mat-form-field>
            <mat-label>Job 2</mat-label>
            <input matInput
                   [formControl]="getAssignmentControl(playerGroup, 2)">
          </mat-form-field>
        </div>
      </div>

      <!-- Col 4, Boss 3 -->
      <div class="px-2">
        <!-- Boss name first col -->
        <mat-form-field>
          <mat-label>Boss 3</mat-label>
          <mat-select formControlName="third">
            <mat-option *ngFor="let bossKey of odyBossKeys"
                        [value]="bossKey">
              {{OdyBoss[bossKey]}}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <!-- Subsequent cells pull player job assignments for boss -->
        <div *ngFor="let playerGroup of playerFormArray.controls; let i = index">
          <mat-form-field>
            <mat-label>Job 3</mat-label>
            <input matInput
                   [formControl]="getAssignmentControl(playerGroup, 3)">
          </mat-form-field>
        </div>
      </div>
    </div>

    <div class="flex-grow-1"></div>
  </div>

  <div class="d-flex flex-wrap">
    <div *ngFor="let jobKey of jobKeys"
         class="job-tile">{{Job[jobKey]}}</div>
  </div>

</mat-card>
